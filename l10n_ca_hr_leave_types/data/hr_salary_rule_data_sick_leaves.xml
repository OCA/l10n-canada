<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="1">
        <record id="SL" model="hr.salary.rule.category">
            <field name="code">SL</field>
            <field name="name">Sick leaves Calculation</field>
        </record> 

        <!-- Sick Leaves - 55 -->
        <record id="rule_ca_sl_available" model="hr.salary.rule">
            <field name="name">Sick leaves available</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="55"/>
            <field name="code">SL_AVAIL</field>
            <field name="appears_on_payslip" eval="0"/>
            <field name="category_id" ref="SL"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
sick_leaves = employee.sum_leave_accruals(employee.id, 'SL', payslip.date_to)
result = sick_leaves['previous_ytd'] \
    + sick_leaves['current_added_ytd'] \
    - sick_leaves['current_taken_ytd']
            </field>
        </record>

        <record id="rule_ca_sl_requested" model="hr.salary.rule">
            <field name="name">Sick leaves requested</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="56"/>
            <field name="code">SL_REQ</field>
            <field name="appears_on_payslip" eval="0"/>
            <field name="category_id" ref="SL"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = payslip.sum_leave_category(payslip, 'SL', multiply_by_rate=False)
            </field>
        </record>

        <record id="rule_ca_sl_taken_cash" model="hr.salary.rule">
            <field name="name">Sick leave hours taken</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="57"/>
            <field name="code">SL_TAKEN_CASH</field>
            <field name="appears_on_payslip" eval="1"/>
            <field name="category_id" ref="SL"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
requested_alw = payslip.sum_leave_category(payslip, 'SL', multiply_by_rate=True)

if SL_AVAIL >= SL_REQ:
    result = requested_alw
elif SL_REQ > 0:
    payslip.reduce_leave_hours(
        payslip, 'SL',
        SL_REQ - SL_AVAIL,
        divide_by_rate=False
    )

    result = payslip.sum_leave_category(payslip, 'SL', multiply_by_rate=True)
else:
    result = 0
            </field>
        </record>

        <record id="rule_ca_sl_taken" model="hr.salary.rule">
            <field name="name">Sick leaves taken</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="58"/>
            <field name="code">SL_TAKEN</field>
            <field name="appears_on_payslip" eval="0"/>
            <field name="category_id" ref="SL"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = payslip.sum_leave_category(payslip, 'SL', multiply_by_rate=False)
            </field>
        </record>

        <record id="rule_ca_unused_sl_taken_cash" model="hr.salary.rule">
            <field name="name">Unused sick leave payment</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="59"/>
            <field name="code">SL_UNUSED_CASH</field>
            <field name="category_id" ref="l10n_ca_hr_payroll.OTHER_WAGE"/>
            <field name="appears_on_payslip" eval="1"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
requested_amount = payslip.sum_payslip_input(payslip, 'SL_UNUSED')

available_hours = SL_AVAIL - SL_TAKEN
available_amount = available_hours * HOURLY_RATE

if available_amount >= requested_amount:
    result = requested_amount
elif requested_amount > 0:
    result = available_amount
    payslip.reduce_payslip_input_amount(payslip, 'SL_UNUSED', requested_amount - available_amount)
else:
    result = 0
            </field>
        </record>

        <record id="rule_ca_unused_sl_taken" model="hr.salary.rule">
            <field name="name">Unused sick leave hours taken</field>
            <field name="structure_id" eval="[(6, 0, [ref('l10n_ca_hr_payroll.hr_structure_ca_base')])]"/>
            <field name="sequence" eval="60"/>
            <field name="code">SL_UNUSED</field>
            <field name="category_id" ref="SL"/>
            <field name="appears_on_payslip" eval="0"/>
            <field name="condition_select">none</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = SL_UNUSED_CASH / HOURLY_RATE
            </field>
        </record>

    </data>
</openerp>